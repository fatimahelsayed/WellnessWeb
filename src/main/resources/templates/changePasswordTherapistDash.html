<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Profile Dashboard</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link
      rel="stylesheet"
      th:href="@{https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css}"
    />
    <link
      th:href="@{https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css}"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      th:href="@{https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700}"
    />
    <link
      rel="stylesheet"
      th:href="@{https://rawcdn.githack.com/Loopple/loopple-public-assets/ad60f16c8a16d1dcad75e176c00d7f9e69320cd4/argon-dashboard/css/nucleo/css/nucleo.css}"/>
    <link
      rel="stylesheet"
      type="text/css"
      th:href="@{/CSS/admindashboard.css}"
    />
  </head>

  <body>
    <div th:replace="~{partials/therapistDashSideBar}"></div>
    <div class="main-content" id="panel">
      <div th:replace="~{partials/therapistDashNavBar}"></div>
      <div class="container-fluid pt-3">
        <div class="row removable">
          <div class="col-lg">
            <form class="user-form" autocomplete="off">
                <h1>Change Password</h1>
                
                <input id="password" class="user-input" name="Password" placeholder="Old Password" type="password" />
                <input type="hidden" id="current-password" th:field="*{therapist.Password}" />
                <span id="password-error" class="error-message"></span>
                <input id="new-pass" class="user-input" name="New-Password" placeholder="New Password" type="password" />
                <span id="new-pass-error" class="error-message"></span>
                <input id="confirm-pass" class="user-input" name="Confirmed-Password" placeholder="Confirm New Password" type="password" />
                <span id="confirmed-pass-error" class="error-message"></span>
                <br>
                <br>
                <button class="btn btn-primary" type="button" onclick="changePasswordAjax()">
                    Change Password
                </button>
            </form>

        </div>
      </div>
    </div>
    <script>
      function validatePasswordForm() {
        var password = document.getElementById("password").value.trim();
        var newpass = document.getElementById("new-pass").value.trim();
        var confrimpass = document.getElementById("confirm-pass").value.trim();
        var i = true;
        var errorElements = document.querySelectorAll(".error-message");
                errorElements.forEach(function (element) {
                  element.innerText = "";
                });
        // Validate password
        if (password === "") {
          document.getElementById("password-error").innerText =
            "Please enter your current password";
          i = false;
        }
        
        if (newpass === "") {
          document.getElementById("new-pass-error").innerText =
            "Please enter your new password";
          i = false;
        }
        if (confrimpass === "") {
          document.getElementById("confirmed-pass-error").innerText =
            "Confirm your new password";
          i = false;
        }
        if (confrimpass !== newpass) {
          document.getElementById("confirmed-pass-error").innerText =
            "The new passwords do not match";
          i = false;
        }
      
        return i;
      }
      function changePasswordAjax() {
        var validForm = validatePasswordForm();
        console.log("In ajax function")
        if (validForm) {
          var formData = {
            oldPassword: $("#password").val(),
            newPassword: $("#confirm-pass").val(),
          };
      
          // Perform AJAX request
          $.ajax({
            type: "POST",
            contentType: "application/json",
            url: "/therapistdashboard/changepassword",
            data: JSON.stringify(formData),
            dataType: "json",
            success: function (response) {
              if (response.status == "success") {
                window.location.href = response.data;
              }else{
                document.getElementById("password-error").innerText = response.data;
      
              }
            },
            error: function (xhr, status, error) {
              console.error(xhr.responseText);
            },
          });
        }
      }
      </script>
    <script src="https://rawcdn.githack.com/Loopple/loopple-public-assets/5cef8f62939eeb089fa26d4c53a49198de421e3d/argon-dashboard/js/vendor/jquery.min.js"></script>
    <script src="https://rawcdn.githack.com/Loopple/loopple-public-assets/5cef8f62939eeb089fa26d4c53a49198de421e3d/argon-dashboard/js/vendor/bootstrap.bundle.min.js"></script>
    <script src="https://rawcdn.githack.com/Loopple/loopple-public-assets/5cef8f62939eeb089fa26d4c53a49198de421e3d/argon-dashboard/js/vendor/js.cookie.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
    <script src="https://rawcdn.githack.com/Loopple/loopple-public-assets/5cef8f62939eeb089fa26d4c53a49198de421e3d/argon-dashboard/js/vendor/chart.extension.js"></script>
    <script src="https://rawcdn.githack.com/Loopple/loopple-public-assets/7bb803d2af2ab6d71d429b0cb459c24a4cd0fbb4/argon-dashboard/js/argon.min.js"></script>
  </body>
</html>
